---
slug: ms-alg
title: iam-ms 轮询重试
authors: krossdev
tags: [kross iam-ms, nats, dev]
---

当发送消息时，一般都是基于一份可选服务提供商的列表. 
比如发送邮件时，存在一份 smtp provider 的列表.
当发送失败时，要基于这一份列表，按某种轮询算法，进行重试。
这里描述该重试算法细节。

<!--truncate-->

这里的轮询重试，跟负载均衡的场景有点类似，但也有很多不同:
负载均衡只选择一次，而重试要选择多次。

- __确定的失败，才允许重试__: 比如超时，就不要重试了。类似 **at most once** 语义
- __provider 之间存在优先次序__:
  你希望消息都从 A 发出去，而不是B。但 A 实在是不行了，才会选B，依次C，D等。
